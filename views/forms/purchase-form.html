{{ define "purchase-form" }}
<h1>Solicitud de Compra</h1>
<form id="addpurchase"
      method="POST"
      action="/request/purchase"
>
  <select id="fields-purchase-type" required>
    <option value="" selected disabled>Tipo</option>
    <option value="catering" disabled>Alimentaci√≥n</option>
    <option value="generic">Servicios</option>
    <option value="supplies" disabled>Suministros</option>
    <option value="goods" disabled>Bienes</option>
  </select>
  <div class="form-section" id="field-generic" style="display:none;">
    {{ template "purchase-form-generic" . }}
  </div>
  <div class="form-section" id="field-catering" style="display:none;">
    {{ template "purchase-form-catering" . }}
  </div>
  <script>
   // Show form fields depending on selected form type
   const formSections = document.querySelectorAll('.form-section');

   function updateSectionVisibility(selected) {
       formSections.forEach(section => {
           section.style.display = 'none';
           // Disable all fields in hidden section
           section.querySelectorAll('input, select, textarea').forEach(input => {
               input.disabled = true;
           });
       });

       const selectedSection = document.getElementById(`field-${selected}`);
       if (selectedSection) {
           selectedSection.style.display = 'block';
           // Enable fields in the visible section
           selectedSection.querySelectorAll('input, select, textarea').forEach(input => {
               input.disabled = false;
           });
       }
   }

   document.getElementById('fields-purchase-type').addEventListener('change', (e) => {
       updateSectionVisibility(e.target.value);
   });

   // Run on page load in case of pre-selected value
   document.addEventListener('DOMContentLoaded', () => {
       const selected = document.getElementById('fields-purchase-type').value;
       if (selected) {
           updateSectionVisibility(selected);
       }
   });
  </script>
  <div style="display:flex;justify-content:right">
    <button
      type="submit"
      onclick="fetchAndSwap(event)"
      target="#addpurchase"
      loading-state
    >Solicitar Compra</button>
  </div>
</form>
{{ end }}
